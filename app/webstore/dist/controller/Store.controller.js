sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/UIComponent","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,o,s,n){"use strict";return e.extend("webstore.webstore.controller.Store",{onBeforeRendering:function(){},onInit(){this.getOwnerComponent().getRouter().getRoute("store").attachPatternMatched(this._onMatched,this);this.getView().setModel(new n({general:{DEFAULT_COUNTRY:"",DEFAULT_LANGUAGE:"",ANON_CUSTOMER:"",SUPPORT_QTY_STEP:false,ZIP_CODE_VALIDATION:false,BP_ROLE:"",CONT_BP_GRP:"",ACCOUNT_GROUP_MAP:"",PRC_PROCEDURE:"",WEIGHT_UNIT:"",DIMENSION_UNIT:"",STOCK_CALCULATION:"",CHECK_RULE:"",DEFAULT_PLANT_PRD:"",DELIVERY_PLANT:"",PRODUCT_STORAGE_LOCATION:""}}),"vm")},async _loadSettingsIntoVM(){const e=this.getView();const t=e.getModel("vm");const o=this._getSettingsListBinding();const s=await o.requestContexts(0,999);const n=this.byId("cbDefaultCountry");n.setSelectedKey(t.getProperty("/general/DEFAULT_COUNTRY"));n.setValue("");const r={};s.forEach(e=>{const t=e.getObject();r[t.attribute]=t.value});t.setProperty("/general/DEFAULT_COUNTRY",r.DEFAULT_COUNTRY||"");t.setProperty("/general/DEFAULT_LANGUAGE",r.DEFAULT_LANGUAGE||"");t.setProperty("/general/ANON_CUSTOMER",r.ANON_CUSTOMER||"");t.setProperty("/general/SUPPORT_QTY_STEP",r.SUPPORT_QTY_STEP==="true");t.setProperty("/general/ZIP_CODE_VALIDATION",r.ZIP_CODE_VALIDATION==="true");t.setProperty("/general/BP_ROLE",r.BP_ROLE||"");t.setProperty("/general/CONT_BP_GRP",r.CONT_BP_GRP||"");t.setProperty("/general/ACCOUNT_GROUP_MAP",r.ACCOUNT_GROUP_MAP||"");t.setProperty("/general/PRC_PROCEDURE",r.PRC_PROCEDURE||"");t.setProperty("/general/WEIGHT_UNIT",r.WEIGHT_UNIT||"");t.setProperty("/general/DIMENSION_UNIT",r.DIMENSION_UNIT||"");t.setProperty("/general/STOCK_CALCULATION",r.STOCK_CALCULATION||"");t.setProperty("/general/CHECK_RULE",r.CHECK_RULE||"");t.setProperty("/general/DEFAULT_PLANT_PRD",r.DEFAULT_PLANT_PRD||"");t.setProperty("/general/DELIVERY_PLANT",r.DELIVERY_PLANT||"");t.setProperty("/general/PRODUCT_STORAGE_LOCATION",r.PRODUCT_STORAGE_LOCATION||"")},async _onMatched(e){const t=this.getView();t.getModel("vm").setProperty("/general",{DEFAULT_COUNTRY:"",DEFAULT_LANGUAGE:"",ANON_CUSTOMER:"",SUPPORT_QTY_STEP:false,ZIP_CODE_VALIDATION:false,BP_ROLE:"",CONT_BP_GRP:"",ACCOUNT_GROUP_MAP:"",PRC_PROCEDURE:"",WEIGHT_UNIT:"",DIMENSION_UNIT:"",STOCK_CALCULATION:"",CHECK_RULE:"",DEFAULT_PLANT_PRD:"",DELIVERY_PLANT:"",PRODUCT_STORAGE_LOCATION:""});t.setModel(new sap.ui.model.json.JSONModel({editMode:false,editcus:false,editPrc:false,editOrd:false,editOrdLines:false,editModePrd:false}),"ui");const o=e.getParameter("arguments").ID;t.bindElement({path:"/Stores('"+o+"')"});await t.getElementBinding().requestObject();await this._loadSettingsIntoVM()},onNavBack(){t.getRouterFor(this).navTo("list")},async onSaveSettings(){try{const e=this.getView();const t=e.getModel();const n=e.getModel("vm");const r=e.getBindingContext();if(!r){s.error("No store context bound");return}const a=r.getProperty("name");const i=t.bindList(r.getPath()+"/settings",null,null,null,{$$updateGroupId:"changes"});const g=await i.requestContexts(0,999);const c={};g.forEach(e=>{const t=e.getObject();c[t.attribute]=e});const l=(e,t)=>{const o=typeof t==="boolean"?String(t):String(t??"");const s=c[e];if(s)s.setProperty("value",o);else i.create({storeName:a,attribute:e,value:o})};l("DEFAULT_COUNTRY",n.getProperty("/general/DEFAULT_COUNTRY"));l("DEFAULT_LANGUAGE",n.getProperty("/general/DEFAULT_LANGUAGE"));l("ANON_CUSTOMER",n.getProperty("/general/ANON_CUSTOMER"));l("SUPPORT_QTY_STEP",n.getProperty("/general/SUPPORT_QTY_STEP"));l("ZIP_CODE_VALIDATION",n.getProperty("/general/ZIP_CODE_VALIDATION"));await t.submitBatch("changes");o.show("Saved");e.getModel("ui").setProperty("/editMode",false)}catch(e){s.error(e?.message||"Save failed")}},onEditSetting(){this.getView().getModel("ui").setProperty("/editMode",true)},onCancelChange:async function(){const e=this.getView();const t=e.getModel();try{t.resetChanges("changes")}catch(e){}await this._loadSettingsIntoVM();e.getModel("ui").setProperty("/editMode",false)},onDeleteSetting(){o.show("TODO: delete selected setting")},onEditAcc(){this.getView().getModel("ui").setProperty("/editcus",true)},async onSaveAcc(){try{const e=this.getView();const t=e.getModel();const n=e.getModel("vm");const r=e.getBindingContext();if(!r){s.error("No store context bound");return}const a=r.getProperty("name");const i=this._getSettingsListBinding();const g=await i.requestContexts(0,999);const c={};g.forEach(e=>{const t=e.getObject();c[t.attribute]=e});const l=(e,t)=>{const o=typeof t==="boolean"?String(t):String(t??"");const s=c[e];if(s)s.setProperty("value",o);else i.create({storeName:a,attribute:e,value:o})};l("BP_ROLE",n.getProperty("/general/BP_ROLE"));l("CONT_BP_GRP",n.getProperty("/general/CONT_BP_GRP"));l("ACCOUNT_GROUP_MAP",n.getProperty("/general/ACCOUNT_GROUP_MAP"));await t.submitBatch("changes");o.show("Saved");this.getView().getModel("ui").setProperty("/editcus",false)}catch(e){s.error(e.message||"Save failed")}},async onCancelAcc(){const e=this.getView();const t=e.getModel();try{t.resetChanges("changes")}catch(e){}await this._loadSettingsIntoVM();e.getModel("ui").setProperty("/editcus",false)},onDocTypeChange:function(e){const t=e.getSource();const o=(t.getValue()||"").trim();const s=t.getItems().some(e=>e.getText()===o);if(!s&&o){t.setValueState("Error");t.setValueStateText("Choose one of: ORDER, QUOTATION, RETURN_ORDER");return}t.setValueState("None");const n=t.getItems().find(e=>e.getText()===o);if(n){t.setSelectedKey(n.getKey())}},onEditOty(){this.getView().getModel("ui").setProperty("/editOrd",true)},_getSettingsListBinding:function(){const e=this.getView().getBindingContext();if(!e)throw new Error("No store context bound");return this.getView().getModel().bindList(e.getPath()+"/settings",null,null,null,{$$updateGroupId:"changes"})},async onSaveOty(){const e=this.getView();const t=e.getModel();try{const o=this.byId("docTypeTable");const s=o.getBinding("items");const n=await s.requestContexts(0,999);for(const e of n){const t=e.getObject();if(t.attribute!=="DOCUMENT_TYPE")continue;const o=(t.value||"").trim();const s=(t.key1||"").trim();const n=(t.key2||"").trim();if(!o){sap.m.MessageBox.error("Document Type cannot be empty.");return}if(!s){sap.m.MessageBox.error(`Sales Doc. Type cannot be empty for ${o}.`);return}if(!n){sap.m.MessageBox.error(`Output Type cannot be empty for ${o}.`);return}}await t.submitBatch("changes");e.getModel("ui").setProperty("/editOrd",false);e.getModel("ui").setProperty("/editOrdLines",false);sap.m.MessageToast.show("Saved")}catch(e){sap.m.MessageBox.error(e?.message||"Save failed")}},async onCancelOty(){const e=this.getView();const t=e.getModel();try{t.resetChanges("changes")}catch(e){}e.getModel("ui").setProperty("/editOrd",false);e.getModel("ui").setProperty("/editOrdLines",false)},onAddDocTypeRow(){const e=this.byId("docTypeTable");const t=e.getBinding("items");t.create({attribute:"DOCUMENT_TYPE",value:"",key1:"",key2:"",key3:"",isDefault:false});this.getView().getModel("ui").setProperty("/editOrdLines",true)},onEditDocTypeRow(){const e=this.byId("docTypeTable");const t=e.getSelectedItem();if(!t){sap.m.MessageToast.show("Select a row first");return}const o=t.getCells();o[0].focus();this.getView().getModel("ui").setProperty("/editOrdLines",true)},async onDeleteDocTypeRows(){const e=this.byId("docTypeTable");const t=e.getSelectedItems();if(!t.length){sap.m.MessageToast.show("Select at least one row to delete");return}await Promise.all(t.map(e=>e.getBindingContext().delete("changes")));e.removeSelections(true);sap.m.MessageToast.show("Deleted")},onDefaultSegChange(e){const t=e.getSource();const o=e.getParameter("key");const s=t.getBindingContext();const n=o==="YES";s.setProperty("isDefault",n);if(n){const e=this.byId("docTypeTable");const t=e.getBinding("items").getContexts();t.forEach(e=>{if(e!==s)e.setProperty("isDefault",false)})}},onEditPrd(){this.getView().getModel("ui").setProperty("/editModePrd",true)},async onSavePrd(){try{const e=this.getView();const t=e.getModel();const n=e.getModel("vm");const r=e.getBindingContext();if(!r){s.error("No store context bound");return}const a=r.getProperty("name");const i=t.bindList(r.getPath()+"/settings",null,null,null,{$$updateGroupId:"changes"});const g=await i.requestContexts(0,999);const c={};g.forEach(e=>{const t=e.getObject();c[t.attribute]=e});const l=(e,t)=>{const o=String(t??"");const s=c[e];if(s)s.setProperty("value",o);else i.create({attribute:e,value:o},true)};l("WEIGHT_UNIT",n.getProperty("/general/WEIGHT_UNIT"));l("DIMENSION_UNIT",n.getProperty("/general/DIMENSION_UNIT"));l("STOCK_CALCULATION",n.getProperty("/general/STOCK_CALCULATION"));l("CHECK_RULE",n.getProperty("/general/CHECK_RULE"));l("DEFAULT_PLANT_PRD",n.getProperty("/general/DEFAULT_PLANT_PRD"));l("DELIVERY_PLANT",n.getProperty("/general/DELIVERY_PLANT"));l("PRODUCT_STORAGE_LOCATION",n.getProperty("/general/PRODUCT_STORAGE_LOCATION"));await t.submitBatch("changes");o.show("Saved");this.getView().getModel("ui").setProperty("/editModePrd",false)}catch(e){s.error(e.message||"Save failed")}},async onCancelPrd(){const e=this.getView();const t=e.getModel();try{t.resetChanges("changes")}catch(e){}await this._loadSettingsIntoVM();e.getModel("ui").setProperty("/editModePrd",false)},async onSavePrc(){try{const e=this.getView();const t=e.getModel();const n=e.getModel("vm");const r=e.getBindingContext();if(!r){s.error("No store context bound");return}const a=r.getProperty("name");const i=t.bindList(r.getPath()+"/settings",null,null,null,{$$updateGroupId:"changes"});const g=await i.requestContexts(0,999);const c={};g.forEach(e=>{const t=e.getObject();c[t.attribute]=e});const l=(e,t)=>{const o=typeof t==="boolean"?String(t):String(t??"");const s=c[e];if(s)s.setProperty("value",o);else i.create({storeName:a,attribute:e,value:o})};l("PRC_PROCEDURE",n.getProperty("/general/PRC_PROCEDURE"));await t.submitBatch("changes");o.show("Saved");e.getModel("ui").setProperty("/editPrc",false)}catch(e){s.error(e?.message||"Save failed")}},onEditPrc(){this.getView().getModel("ui").setProperty("/editPrc",true)},onCancelPrc:async function(){const e=this.getView();const t=e.getModel();try{t.resetChanges("changes")}catch(e){}await this._loadSettingsIntoVM();e.getModel("ui").setProperty("/editPrc",false)},onCountrySelect:function(e){const t=e.getParameter("selectedItem");if(!t)return;const o=t.getText();this.getView().getModel("vm").setProperty("/general/DEFAULT_COUNTRY",o)}})});
//# sourceMappingURL=Store.controller.js.map